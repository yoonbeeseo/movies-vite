import{i as E,h as M,a as O,j as s,L as I,r as x,R as S}from"./index-CSlK2N2J.js";import{Q as F,u as Q,t as $}from"./tmdb-BSMAuMny.js";var V=class extends F{constructor(e,t){super(e,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e){super.setOptions({...e,behavior:E()})}getOptimisticResult(e){return e.behavior=E(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,t){var g,p;const{state:a}=e,n=super.createResult(e,t),{isFetching:d,isRefetching:c,isError:o,isRefetchError:i}=n,r=(p=(g=a.fetchMeta)==null?void 0:g.fetchMore)==null?void 0:p.direction,l=o&&r==="forward",u=d&&r==="forward",h=o&&r==="backward",b=d&&r==="backward";return{...n,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:O(t,a.data),hasPreviousPage:M(t,a.data),isFetchNextPageError:l,isFetchingNextPage:u,isFetchPreviousPageError:h,isFetchingPreviousPage:b,isRefetchError:i&&!l&&!h,isRefetching:c&&!u&&!b}}};function A(e,t){return Q(e,V)}const B=e=>s.jsx(I,{to:e.id.toString(),children:s.jsxs("div",{className:"rounded-2xl p-2.5 border-gray-200 hover:shadow-md",children:[s.jsx("div",{className:"overflow-hidden rounded-2xl hover:shadow-md hover:opacity-90",children:s.jsx("img",{alt:e.title,src:`https://image.tmdb.org/t/p/w500${e.poster_path}`,width:180,height:320,className:"w-full"})}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex flex-col gap-y-1 mt-2.5",children:[s.jsx("h2",{className:"font-semibold",children:e.title}),e.title!==e.original_title&&s.jsx("p",{className:"text-gray-500 text-xs",children:e.original_title}),s.jsx("p",{className:"line-clamp-3",children:e.overview})]}),s.jsxs("div",{className:"flex gap-x-2.5 items-center",children:[s.jsx("div",{className:"flex-1 h-4 rounded-full bg-yellow-50 flex flex-col justify-center px-1",children:s.jsx("span",{className:"block h-2 rounded-full bg-yellow-200",style:{width:`${e.vote_average/10*100}%`}})}),s.jsxs("p",{children:[e.vote_average,"점"]})]})]})]})});var N=new Map,P=new WeakMap,_=0,L=void 0;function T(e){return e?(P.has(e)||(_+=1,P.set(e,_.toString())),P.get(e)):"0"}function q(e){return Object.keys(e).sort().filter(t=>e[t]!==void 0).map(t=>`${t}_${t==="root"?T(e.root):e[t]}`).toString()}function C(e){const t=q(e);let a=N.get(t);if(!a){const n=new Map;let d;const c=new IntersectionObserver(o=>{o.forEach(i=>{var r;const l=i.isIntersecting&&d.some(u=>i.intersectionRatio>=u);e.trackVisibility&&typeof i.isVisible>"u"&&(i.isVisible=l),(r=n.get(i.target))==null||r.forEach(u=>{u(l,i)})})},e);d=c.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),a={id:t,observer:c,elements:n},N.set(t,a)}return a}function z(e,t,a={},n=L){if(typeof window.IntersectionObserver>"u"&&n!==void 0){const r=e.getBoundingClientRect();return t(n,{isIntersecting:n,target:e,intersectionRatio:typeof a.threshold=="number"?a.threshold:0,time:0,boundingClientRect:r,intersectionRect:r,rootBounds:r}),()=>{}}const{id:d,observer:c,elements:o}=C(a),i=o.get(e)||[];return o.has(e)||o.set(e,i),i.push(t),c.observe(e),function(){i.splice(i.indexOf(t),1),i.length===0&&(o.delete(e),c.unobserve(e)),o.size===0&&(c.disconnect(),N.delete(d))}}function D({threshold:e,delay:t,trackVisibility:a,rootMargin:n,root:d,triggerOnce:c,skip:o,initialInView:i,fallbackInView:r,onChange:l}={}){var u;const[h,b]=x.useState(null),m=x.useRef(l),[g,p]=x.useState({inView:!!i,entry:void 0});m.current=l,x.useEffect(()=>{if(o||!h)return;let v;return v=z(h,(R,w)=>{p({inView:R,entry:w}),m.current&&m.current(R,w),w.isIntersecting&&c&&v&&(v(),v=void 0)},{root:d,rootMargin:n,threshold:e,trackVisibility:a,delay:t},r),()=>{v&&v()}},[Array.isArray(e)?e.toString():e,h,d,n,c,o,a,r,t]);const j=(u=g.entry)==null?void 0:u.target,y=x.useRef(void 0);!h&&j&&!c&&!o&&y.current!==j&&(y.current=j,p({inView:!!i,entry:void 0}));const f=[b,g.inView,g.entry];return f.ref=f[0],f.inView=f[1],f.entry=f[2],f}const U=()=>{const{data:e,status:t,error:a,isFetchingNextPage:n,fetchNextPage:d,hasNextPage:c}=A({queryKey:["movies"],initialPageParam:1,queryFn:async({pageParam:r})=>{const l=`https://api.themoviedb.org/3/discover/movie?include_adult=false&include_video=false&language=en-US&page=${r}&sort_by=popularity.desc`;return await(await fetch(l,$())).json()},getNextPageParam:r=>r.page<r.total_pages?r.page+1:void 0}),{ref:o,inView:i}=D({threshold:.25});return x.useEffect(()=>{i&&c&&!n&&(console.log("load more movies"),d())},[i,c,n,d]),t==="pending"?s.jsx(S,{}):t==="error"?s.jsxs("h1",{children:["Error ",a.message]}):e&&s.jsxs("div",{children:[e.pages.map((r,l)=>s.jsx("ul",{className:"grid grid-cols-2 gap-5 px-5",children:r.results.map(u=>s.jsx("li",{children:s.jsx(B,{...u})},u.id))},l)),n&&s.jsx("div",{className:"p-10",children:"loading more..."}),s.jsx("div",{ref:o,className:"border p-5",children:"Read More"})]})};export{U as default};
